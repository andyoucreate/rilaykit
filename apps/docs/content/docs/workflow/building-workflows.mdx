---
title: Building Workflows
description: How to define multi-step workflows with the flow builder.
---
import { Step, Steps } from 'fumadocs-ui/components/steps';
import { Callout } from 'fumadocs-ui/components/callout';

A workflow is a sequence of steps, where each step is usually a Rilaykit form. The workflow builder allows you to chain these steps together and configure the navigation logic between them.

## The `flow` Builder

The `flow` class provides a static factory method to build multi-step workflows. It follows the same builder pattern as forms, with method chaining and full type safety.

<Steps>
<Step>
### 1. Create your Form Configurations

First, you need a `formConfig` for each step of your workflow. You'll create these using the standard form builder.

```tsx
import { rilay } from '@/lib/rilay';
    import { form } from '@rilaykit/forms';

const personalInfoForm = form.create(rilay, 'personal-info').add(...).build();
const preferencesForm = form.create(rilay, 'preferences').add(...).build();
const reviewForm = form.create(rilay, 'review').add(...).build();
```
<Callout>
You can also pass a `form` builder instance directly to a step. It will be built automatically.
</Callout>
</Step>
<Step>
### 2. Start the Flow Builder

Use `flow.create()` to begin building your workflow. The workflow ID and name are optional â€” if not provided, they will be auto-generated.

```tsx
import { rilay } from '@/lib/rilay';

// With explicit ID and name (recommended for production)
const workflowBuilder = flow.create(rilay,
    'user-onboarding',
    'User Onboarding Workflow',
    'A multi-step workflow to onboard new users' // Optional description
  )

// With auto-generated ID and default name (useful for prototyping)
const quickWorkflow = flow.create(rilay)
```
</Step>
<Step>
### 3. Add Steps

Use `.step()` to add steps to your workflow. You must provide at least a `title` and `formConfig`.

```tsx
//...
.step({
  id: 'personal-info',
  title: 'Personal Information',
  description: 'Tell us about yourself',
  formConfig: personalInfoForm,
})
.step({
  id: 'preferences',
  title: 'Preferences',
  description: 'Set your preferences',
  formConfig: preferencesForm,
  allowSkip: true, // This step is optional
})
.step({
  id: 'review',
  title: 'Review & Feedback',
  description: 'Review your information',
  formConfig: reviewForm,
})
// ...
```
</Step>
<Step>
### 4. Configure Navigation and Hooks

You can configure the overall workflow behavior with the unified `.configure()` method.

```tsx
// ...
.configure({
  analytics: {
    onWorkflowStart: (workflowId) => console.log(`Workflow ${workflowId} started.`),
    onStepComplete: (stepId, duration) => console.log(`Step ${stepId} took ${duration}ms.`),
  }
})
// ...
```
</Step>
<Step>
### 5. Build the Configuration

Finally, call `.build()` to get the final `workflowConfig` object.

```tsx
const workflowConfig = flow.create(rilay, ...)
  .step(...)
  .step(...)
  .configure(...)
  .build();
```
This configuration can now be passed to the `<Workflow>` component, which will build it automatically if you pass the builder instance.
</Step>
</Steps>

## When to use `.build()`

Just like with forms, you often don't need to call `.build()` on a workflow builder. The `<Workflow />` component handles it for you.

You should call `.build()` manually when you need the final, serializable `WorkflowConfig` object, for example, to save it as JSON or for debugging.

## Step Configuration

The object passed to `.step()` has several options:

- `id` (optional): A unique identifier for the step. Auto-generated if not provided.
- `title` (required): A human-readable title for the step, often shown in the stepper.
- `description` (optional): A short description of the step.
- `formConfig` (required): The form configuration or form builder instance for this step.
- `renderer` (optional): A custom renderer for the body of this specific step.
- `allowSkip` (optional, default: `false`): If `true`, users can skip this step via `<WorkflowSkipButton>`.
- `metadata` (optional): Structured metadata object with `icon`, `category`, `tags`, and custom fields.
- `conditions` (optional): Conditional behavior configuration (visibility, skippable state).
- **`after` (recommended)**: Simplified callback with single parameter containing step data and helpers. See [Advanced Workflows](/docs/workflow/advanced-workflows).
- `onAfterValidation` (deprecated): Legacy 3-parameter callback. Use `after` instead for better DX.

---

## Complete Example: User Onboarding Workflow

Let's put it all together. Here is a full example of a 3-step user onboarding workflow.

First, we define the forms for each step:

```tsx
// 1. Define the forms for each step
const accountForm = form.create(rilay, 'account-form')
  .add(
    { id: 'email', type: 'email', props: { label: 'Email' }, validation: { validate: [required(), email()] } },
    { id: 'password', type: 'password', props: { label: 'Password' }, validation: { validate: [required(), minLength(8)] } }
  );

const profileForm = form.create(rilay, 'profile-form')
  .add(
    { id: 'firstName', type: 'text', props: { label: 'First Name' } },
    { id: 'lastName', type: 'text', props: { label: 'Last Name' } }
  );

const confirmationForm = form.create(rilay, 'confirmation-form')
  .add({
    id: 'terms',
    type: 'checkbox', // Assumes a 'checkbox' component is registered
    props: {
      label: 'I agree to the terms and conditions',
    },
    validation: {
      validate: [
        custom(value => value === true, 'You must accept the terms')
      ]
    }
  });
```

<Callout title="About Validation">
  This example uses several built-in validators. To learn more about how validation works in Rilay, check out our in-depth [Field and Form Validation](/docs/forms/validation) guide.
</Callout>

Now, we use the `flow` builder to chain them together into a workflow:

```tsx
// 2. Build the workflow
export const onboardingWorkflow = flow.create(rilay,
    'onboarding',
    'New User Onboarding'
  )
  .step({
    id: 'account-creation',
    title: 'Create Account',
    formConfig: accountForm,
    metadata: { icon: 'user', category: 'account' },
    after: async (step) => {
      // Simplified callback signature
      console.log('Account created:', step.data.email);

      // Pre-fill next step with user's email
      step.next.prefill({
        email: step.data.email
      });
    }
  })
  .step({
    id: 'personal-info',
    title: 'Your Profile',
    formConfig: profileForm,
    metadata: { icon: 'profile', category: 'profile' }
  })
  .step({
    id: 'confirmation',
    title: 'Confirmation',
    formConfig: confirmationForm,
    metadata: { icon: 'check', category: 'confirmation' }
  })
  .configure({
    analytics: {
      onWorkflowStart: (id) => console.log(`Started: ${id}`),
      onWorkflowComplete: (id, totalTime) => console.log(`Completed: ${id} in ${totalTime}ms`),
    },
  });
```

<Callout type="info">
**New in v0.2:** The simplified `after` callback replaces the verbose `onAfterValidation` (still supported but deprecated).
</Callout>

This `onboardingWorkflow` builder instance is ready to be passed to the `<Workflow />` component, providing a complete multi-step form experience out of the box. 